<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åå° - Noah Box</title>
    <link rel="stylesheet" href="code-editor-theme.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">Noah Box</a>
                <nav class="nav">
                    <a href="/" class="nav-button">
                        ğŸ  home
                    </a>
                    <a href="/downloads.html" class="nav-button">
                        ğŸ“ downloads
                    </a>
                    <button class="nav-button" onclick="toggleTheme()">
                        ğŸŒ“ theme
                    </button>
                    <button class="nav-button" onclick="logout()">
                        ğŸšª logout
                    </button>
                </nav>
            </div>
        </div>
    </header>

    <div class="admin-layout">
        <aside class="admin-sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">// ç®¡ç†é¢æ¿</div>
            </div>
            
            <ul class="sidebar-menu">
                <li>
                    <a href="#dashboard" class="sidebar-link active" onclick="showSection('dashboard')">
                        <span class="sidebar-icon">ğŸ“Š</span>
                        <span>ä»ªè¡¨æ¿</span>
                    </a>
                </li>
                <li>
                    <a href="#files" class="sidebar-link" onclick="showSection('files')">
                        <span class="sidebar-icon">ğŸ“</span>
                        <span>æ–‡ä»¶ç®¡ç†</span>
                    </a>
                </li>
                <li>
                    <a href="#upload" class="sidebar-link" onclick="showSection('upload')">
                        <span class="sidebar-icon">â¬†ï¸</span>
                        <span>æ–‡ä»¶ä¸Šä¼ </span>
                    </a>
                </li>
                <li>
                    <a href="#settings" class="sidebar-link" onclick="showSection('settings')">
                        <span class="sidebar-icon">âš™ï¸</span>
                        <span>ç³»ç»Ÿè®¾ç½®</span>
                    </a>
                </li>
            </ul>
        </aside>

        <main class="admin-content">
            <!-- ä»ªè¡¨æ¿ -->
            <section id="dashboard" class="content-section active">
                <div class="content-header">
                    <h1 class="content-title">// ä»ªè¡¨æ¿</h1>
                    <p class="content-description">ç³»ç»Ÿæ¦‚è§ˆå’Œå…³é”®æŒ‡æ ‡</p>
                </div>

                <div class="stats-grid" style="margin-bottom: 32px;">
                    <div class="stat-card">
                        <div class="stat-label">const totalFiles =</div>
                        <div class="stat-value" id="totalFiles">0</div>
                        <div class="stat-description">// æ€»æ–‡ä»¶æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">const storageUsed =</div>
                        <div class="stat-value" id="storageUsed">0</div>
                        <div class="stat-description">// å­˜å‚¨ä½¿ç”¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">const todayDownloads =</div>
                        <div class="stat-value" id="todayDownloads">0</div>
                        <div class="stat-description">// ä»Šæ—¥ä¸‹è½½</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">const activeUsers =</div>
                        <div class="stat-value" id="activeUsers">0</div>
                        <div class="stat-description">// æ´»è·ƒç”¨æˆ·</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">// ç³»ç»ŸçŠ¶æ€</h3>
                        <p class="card-description">å®æ—¶ç³»ç»Ÿå¥åº·çŠ¶å†µç›‘æ§</p>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="color: var(--success); font-size: 16px;">âœ…</span>
                            <div>
                                <div style="font-weight: 500; color: var(--text-primary);">ç³»ç»Ÿè¿è¡Œ</div>
                                <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">// status: online</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="color: var(--success); font-size: 16px;">âœ…</span>
                            <div>
                                <div style="font-weight: 500; color: var(--text-primary);">æ•°æ®åº“</div>
                                <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">// connection: ok</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="color: var(--success); font-size: 16px;">âœ…</span>
                            <div>
                                <div style="font-weight: 500; color: var(--text-primary);">å­˜å‚¨ç©ºé—´</div>
                                <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">// space: available</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span style="color: var(--warning); font-size: 16px;">âš ï¸</span>
                            <div>
                                <div style="font-weight: 500; color: var(--text-primary);">å¤‡ä»½çŠ¶æ€</div>
                                <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">// last: 3 days ago</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æ–‡ä»¶ç®¡ç† -->
            <section id="files" class="content-section">
                <div class="content-header">
                    <h1 class="content-title">// æ–‡ä»¶ç®¡ç†</h1>
                    <p class="content-description">ç®¡ç†å’Œç»„ç»‡æ‚¨çš„æ–‡ä»¶èµ„æº</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">// æ–‡ä»¶åˆ—è¡¨</h3>
                        <div style="display: flex; gap: 12px;">
                            <button class="btn btn-secondary" onclick="loadFiles()">ğŸ”„ refresh</button>
                            <button class="btn btn-primary" onclick="showSection('upload')">â¬†ï¸ upload</button>
                        </div>
                    </div>
                    
                    <div id="fileTableContainer">
                        <div class="message">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...</div>
                    </div>
                </div>
            </section>

            <!-- æ–‡ä»¶ä¸Šä¼  -->
            <section id="upload" class="content-section">
                <div class="content-header">
                    <h1 class="content-title">// æ–‡ä»¶ä¸Šä¼ </h1>
                    <p class="content-description">ä¸Šä¼ æ–°æ–‡ä»¶åˆ°ç³»ç»Ÿ</p>
                </div>

                <div class="card">
                    <div style="border: 2px dashed var(--border); border-radius: 4px; padding: 48px 24px; text-align: center; background: var(--bg-tertiary); transition: all 0.3s; cursor: pointer;" id="uploadZone">
                        <div style="font-size: 48px; color: var(--text-muted); margin-bottom: 16px;">ğŸ“</div>
                        <div style="font-size: 16px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px;">
                            æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©
                        </div>
                        <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 24px;">
                            // æ”¯æŒå¤šæ–‡ä»¶ä¸Šä¼ ï¼Œæœ€å¤§å•æ–‡ä»¶ 100MB
                        </div>
                        <input type="file" id="fileInput" multiple style="display: none;">
                        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                            ğŸ“‚ selectFiles()
                        </button>
                    </div>
                    
                    <div id="uploadProgress" style="display: none; margin-top: 24px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="font-family: 'JetBrains Mono', monospace; font-size: 13px;">// ä¸Šä¼ è¿›åº¦</span>
                            <span id="progressText" style="font-family: 'JetBrains Mono', monospace; font-size: 13px;">0%</span>
                        </div>
                        <div style="width: 100%; height: 6px; background: var(--bg-tertiary); border-radius: 3px; overflow: hidden;">
                            <div id="progressFill" style="height: 100%; background: linear-gradient(90deg, var(--code-keyword), var(--code-string)); border-radius: 3px; transition: width 0.3s ease; width: 0%;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <section id="settings" class="content-section">
                <div class="content-header">
                    <h1 class="content-title">// ç³»ç»Ÿè®¾ç½®</h1>
                    <p class="content-description">é…ç½®ç³»ç»Ÿå‚æ•°å’Œå®‰å…¨è®¾ç½®</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">// å®‰å…¨è®¾ç½®</h3>
                        <p class="card-description">ä¿®æ”¹ç®¡ç†å‘˜å¯†ç å’Œå®‰å…¨é…ç½®</p>
                    </div>
                    
                    <form id="passwordForm" style="max-width: 400px;">
                        <div class="form-group">
                            <label class="form-label">// å½“å‰å¯†ç </label>
                            <input type="password" class="form-input" id="currentPassword" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç " required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">// æ–°å¯†ç </label>
                            <input type="password" class="form-input" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">// ç¡®è®¤æ–°å¯†ç </label>
                            <input type="password" class="form-input" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " required>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            ğŸ” updatePassword()
                        </button>
                    </form>
                </div>
            </section>
        </main>
    </div>

    <script>
        function toggleTheme() {
            console.log('Theme toggle clicked');
        }

        function showSection(sectionId) {
            // éšè—æ‰€æœ‰éƒ¨åˆ†
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰èœå•é¡¹çš„activeç±»
            document.querySelectorAll('.sidebar-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // æ˜¾ç¤ºæŒ‡å®šéƒ¨åˆ†
            document.getElementById(sectionId).classList.add('active');
            
            // æ·»åŠ activeç±»åˆ°å¯¹åº”èœå•é¡¹
            document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
            
            // æ ¹æ®éƒ¨åˆ†åŠ è½½ç›¸åº”æ•°æ®
            if (sectionId === 'files') {
                loadFiles();
            } else if (sectionId === 'dashboard') {
                loadDashboard();
            }
        }

        function loadDashboard() {
            // æ¨¡æ‹Ÿæ•°æ®
            document.getElementById('totalFiles').textContent = '24';
            document.getElementById('storageUsed').textContent = '156MB';
            document.getElementById('todayDownloads').textContent = '18';
            document.getElementById('activeUsers').textContent = '5';
        }

        function loadFiles() {
            const container = document.getElementById('fileTableContainer');
            container.innerHTML = '<div class="message">æ­£åœ¨åŠ è½½æ–‡ä»¶åˆ—è¡¨...</div>';

            // æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨
            setTimeout(() => {
                const files = [
                    { name: 'README.md', size: '2.5 KB', modified: '2024-01-15' },
                    { name: 'config.json', size: '1.2 KB', modified: '2024-01-14' },
                    { name: 'app.js', size: '15.8 KB', modified: '2024-01-13' },
                    { name: 'style.css', size: '8.4 KB', modified: '2024-01-12' }
                ];

                container.innerHTML = `
                    <div style="background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 4px; overflow: hidden;">
                        <div style="padding: 16px 20px; border-bottom: 1px solid var(--border); font-family: 'JetBrains Mono', monospace; font-size: 13px; font-weight: 600; color: var(--text-primary);">
                            // æ–‡ä»¶åˆ—è¡¨ (${files.length} ä¸ªæ–‡ä»¶)
                        </div>
                        ${files.map(file => `
                            <div style="display: grid; grid-template-columns: 1fr auto auto; align-items: center; padding: 16px 20px; border-bottom: 1px solid var(--border); transition: all 0.2s;">
                                <div>
                                    <div style="font-family: 'JetBrains Mono', monospace; font-weight: 500; color: var(--text-primary); margin-bottom: 4px;">${escapeHtml(file.name)}</div>
                                    <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">${file.size} â€¢ ${file.modified}</div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px;" onclick="downloadFile('${escapeHtml(file.name)}')" title="ä¸‹è½½">
                                        â¬‡ï¸
                                    </button>
                                    <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 11px; color: var(--error);" onclick="deleteFile('${escapeHtml(file.name)}')" title="åˆ é™¤">
                                        ğŸ—‘ï¸
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }, 1000);
        }

        function setupFileUpload() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');

            uploadZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = 'var(--code-keyword)';
                uploadZone.style.background = 'var(--bg-primary)';
            });

            uploadZone.addEventListener('dragleave', () => {
                uploadZone.style.borderColor = 'var(--border)';
                uploadZone.style.background = 'var(--bg-tertiary)';
            });

            uploadZone.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadZone.style.borderColor = 'var(--border)';
                uploadZone.style.background = 'var(--bg-tertiary)';
                uploadFiles(e.dataTransfer.files);
            });

            fileInput.addEventListener('change', (e) => {
                uploadFiles(e.target.files);
            });
        }

        function uploadFiles(files) {
            if (files.length === 0) return;

            const progressContainer = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressContainer.style.display = 'block';

            // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    
                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                        progressFill.style.width = '0%';
                        progressText.textContent = '0%';
                        
                        showMessage('æ–‡ä»¶ä¸Šä¼ å®Œæˆï¼', 'success');
                        
                        if (document.getElementById('files').classList.contains('active')) {
                            loadFiles();
                        }
                    }, 1000);
                }
                
                progressFill.style.width = progress + '%';
                progressText.textContent = Math.round(progress) + '%';
            }, 200);
        }

        function downloadFile(filename) {
            const link = document.createElement('a');
            link.href = `/api/download/${encodeURIComponent(filename)}`;
            link.download = filename;
            link.click();
        }

        function deleteFile(filename) {
            if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${filename}" å—ï¼Ÿ`)) return;
            
            showMessage('æ–‡ä»¶åˆ é™¤æˆåŠŸï¼', 'success');
            loadFiles();
        }

        function setupPasswordForm() {
            document.getElementById('passwordForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;

                if (newPassword !== confirmPassword) {
                    showMessage('æ–°å¯†ç å’Œç¡®è®¤å¯†ç ä¸åŒ¹é…', 'error');
                    return;
                }

                if (newPassword.length < 6) {
                    showMessage('æ–°å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦', 'error');
                    return;
                }

                try {
                    const response = await fetch('/api/change-password', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ currentPassword, newPassword })
                    });

                    const result = await response.json();
                    
                    if (result.success) {
                        showMessage('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•', 'success');
                        setTimeout(() => logout(), 2000);
                    } else {
                        showMessage(result.message || 'å¯†ç ä¿®æ”¹å¤±è´¥', 'error');
                    }
                } catch (error) {
                    showMessage('ä¿®æ”¹å¯†ç å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            });
        }

        function showMessage(text, type = 'success') {
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = `// ${text}`;
            document.getElementById('settings').appendChild(message);
            setTimeout(() => message.remove(), 3000);
        }

        function logout() {
            fetch('/api/logout', { method: 'POST' })
                .then(() => window.location.href = '/login.html')
                .catch(() => window.location.href = '/login.html');
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function checkAuth() {
            try {
                const response = await fetch('/api/check-auth');
                if (!response.ok && location.hostname !== 'localhost') {
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('æ£€æŸ¥ç™»å½•çŠ¶æ€å¤±è´¥:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            setupFileUpload();
            setupPasswordForm();
            loadDashboard();
        });
    </script>
</body>
</html>